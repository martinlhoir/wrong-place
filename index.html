import React, { useState, useEffect } from "react";
import { Card, CardContent } from "./components/ui/card"; // chemins relatifs
import { Button } from "./components/ui/button";
import { motion } from "framer-motion";

// 60 mots
const motsRares = [
  { mot: "Escarboucle", choix: ["Precious stone", "Carpentry tool", "Water bird"], reponse: "Precious stone" },
  { mot: "Chalemie", choix: ["Medieval wind instrument", "Poisonous plant", "Part of a ship"], reponse: "Medieval wind instrument" },
  { mot: "Obombrer", choix: ["To darken with a shadow", "To cover with paint", "To reduce to dust"], reponse: "To darken with a shadow" },
  { mot: "Sybarite", choix: ["Person who loves luxury", "Small nocturnal mammal", "Ancient blacksmith trade"], reponse: "Person who loves luxury" },
  { mot: "Raisiné", choix: ["Grape jam", "Volcanic rock", "Religious chant"], reponse: "Grape jam" },
  { mot: "Amphigouri", choix: ["Obscure speech", "Ancient clothing", "Old currency"], reponse: "Obscure speech" },
  { mot: "Lambrequin", choix: ["Drapery ornament", "Musical instrument", "Climbing plant"], reponse: "Drapery ornament" },
  { mot: "Péroraison", choix: ["Conclusion of a speech", "Agricultural tool", "Religious ritual"], reponse: "Conclusion of a speech" },
  { mot: "Luzerne", choix: ["Forage plant", "Precious stone", "Type of ship"], reponse: "Forage plant" },
  { mot: "Mirliton", choix: ["Small musical instrument", "Bird", "Ancient pastry"], reponse: "Small musical instrument" },
  // … (ajoute les 50 autres mots ici pour avoir 60)
];

// Mélanger tableau
function melangerTableau(tableau) {
  return [...tableau].sort(() => Math.random() - 0.5);
}

export default function JeuMots() {
  const [started, setStarted] = useState(false);
  const [fini, setFini] = useState(false);
  const [questions, setQuestions] = useState([]);
  const [index, setIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [message, setMessage] = useState("");

  useEffect(() => {
    if (started) {
      const melange = melangerTableau(motsRares).slice(0, 10);
      setQuestions(melange);
      setIndex(0);
      setScore(0);
      setFini(false);
    }
  }, [started]);

  const verifierReponse = (choix) => {
    if (!questions[index]) return;
    if (choix === questions[index].reponse) setScore((s) => s + 1);
    setMessage(choix === questions[index].reponse ? "✅ Correct answer!" : "❌ Wrong answer!");
    setTimeout(() => {
      setMessage("");
      if (index + 1 < 10) setIndex((prev) => prev + 1);
      else setFini(true);
    }, 1000);
  };

  const getFinalMessage = () => {
    if (score < 5) return "Too bad, maybe another time";
    if (score < 10) return "Well done, but not excellent";
    return "Just too strong!";
  };

  if (!started)
    return (
      <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-purple-200 to-blue-200 p-6">
        <Card className="w-full max-w-2xl shadow-xl rounded-2xl p-10 bg-white text-center">
          <CardContent className="flex flex-col gap-6">
            <h1 className="text-3xl font-bold">Welcome to the Word Guessing Game</h1>
            <p className="text-lg text-gray-700">
              The goal is to guess the meaning of rare French words. <br />
              10 random questions from 60 words. Try to get the highest score!
            </p>
            <Button onClick={() => setStarted(true)} className="rounded-xl p-4 text-lg shadow-md bg-indigo-600 text-white hover:bg-indigo-700">
              Start Game
            </Button>
          </CardContent>
        </Card>
      </div>
    );

  if (fini)
    return (
      <div className="h-screen w-screen flex flex-col items-center justify-center bg-gradient-to-br from-green-200 to-blue-200 p-6">
        <Card className="w-full max-w-2xl shadow-xl rounded-2xl p-10 bg-white text-center">
          <CardContent className="flex flex-col gap-6">
            <h1 className="text-3xl font-bold">Game Over</h1>
            <p className="text-lg">Your final score is: {score} / 10</p>
            <p className="text-xl font-semibold">{getFinalMessage()}</p>
            <Button onClick={() => setStarted(false)} className="rounded-xl p-4 text-lg shadow-md bg-indigo-600 text-white hover:bg-indigo-700">
              Play Again
            </Button>
          </CardContent>
        </Card>
      </div>
    );

  const motActuel = questions[index];

  return (
    <div className="h-screen w-screen flex flex-col items-center justify-center bg-gradient-to-br from-purple-200 to-blue-200 p-6">
      <Card className="w-full max-w-2xl shadow-xl rounded-2xl p-6 bg-white h-[90%] flex flex-col justify-between">
        <CardContent className="flex flex-col items-center gap-6 flex-grow">
          <h1 className="text-2xl font-bold text-center">Guess the meaning of the word</h1>
          <motion.h2 key={motActuel.mot} initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="text-xl font-semibold text-indigo-700">
            {motActuel.mot}
          </motion.h2>
          <div className="grid gap-3 w-full">
            {melangerTableau(motActuel.choix).map((choix, i) => (
              <Button key={i} onClick={() => verifierReponse(choix)} className="rounded-xl p-3 shadow-md hover:bg-indigo-100">
                {choix}
              </Button>
            ))}
          </div>
          {message && <p className="text-lg font-medium">{message}</p>}
          <p className="text-sm text-gray-600">Score : {score} / {index + 1}</p>
        </CardContent>
      </Card>
    </div>
  );
}
